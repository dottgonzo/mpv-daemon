"use strict";
var chai = require("chai");
var index_1 = require("../index");
var Player = new index_1.mpvdaemon();
var expect = chai.expect;
describe("mpv class playlist from file", function () {
    describe("configuration", function () {
        it("expect return an object", function () {
            expect(Player).to.be.ok;
        });
        it("expect to have property playlist", function () {
            expect(Player).to.have.property('playlist').that.is.an('array');
        });
        it("expect to have property daemonized", function () {
            expect(Player).to.have.property('daemonized').that.is.not.ok;
        });
        it("start", function (done) {
            this.timeout(50000);
            Player.start().then(function (a) {
                expect(Player).to.have.property('daemonized').that.is.ok;
                done();
            }).catch(function (err) {
                expect(err).to.not.exist;
                done();
            });
        });
        it("player is now daemonized", function () {
            expect(Player).to.have.property('daemonized').that.is.ok;
        });
        it("player is not playing now", function () {
            expect(Player).to.have.property('playing').that.is.not.ok;
        });
    });
    describe("playlist", function () {
        it("load a playlist from file", function (done) {
            this.timeout(50000);
            Player.loadListfromFile(__dirname + "/localplaylist.pls", true).then(function (a) {
                expect(Player.playlist.length).to.be.eq(2);
                expect(Player.playlist[0]).to.have.property('title');
                expect(Player.playlist[0]).to.have.property('uri');
                expect(Player.playlist[0]).to.have.property('label');
                expect(Player.playing).to.be.ok;
                setTimeout(function () {
                    done();
                }, 3000);
            }).catch(function (err) {
                console.log(err);
                expect(err).to.not.exist;
                done();
            });
        });
        it("player is running now", function () {
            expect(Player).to.have.property('playing').that.is.ok;
        });
        it("The track is the number 1", function () {
            expect(Player).to.have.property('track').that.eq(1);
        });
        it("switch to next track what", function (done) {
            this.timeout(50000);
            Player.next().then(function (a) {
                expect(Player.playlist.length).to.be.eq(2);
                expect(Player).to.have.property('track').that.eq(2);
                setTimeout(function () {
                    done();
                }, 3000);
            }).catch(function (err) {
                expect(err).to.not.exist;
                done();
            });
        });
        it("switch to prev track best", function (done) {
            this.timeout(50000);
            Player.prev().then(function (a) {
                expect(Player.playlist.length).to.be.eq(2);
                expect(Player).to.have.property('track').that.eq(1);
                setTimeout(function () {
                    done();
                }, 3000);
            }).catch(function (err) {
                expect(err).to.not.exist;
                done();
            });
        });
    });
    describe("start with a video", function () {
        it("expect a video", function (done) {
            this.timeout(50000);
            Player.play(__dirname + "/../videos/hoedown.mp4").then(function () {
                expect(Player).to.be.ok;
                expect(Player.playlist.length).to.be.eq(1);
                expect(Player).to.have.property('track').that.eq(1);
                setTimeout(function () {
                    done();
                }, 3000);
            });
        });
        it("switch to another video", function (done) {
            this.timeout(50000);
            Player.start(__dirname + "/../videos/toccata.mp4").then(function () {
                expect(Player).to.be.ok;
                expect(Player.playlist.length).to.be.eq(1);
                expect(Player).to.have.property('track').that.eq(1);
                setTimeout(function () {
                    done();
                }, 3000);
            });
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFTLEdBQUcsd0JBQXdCLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ3BELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztnQkFDeEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO2dCQUNuRCxVQUFVLENBQUM7b0JBQ1AsSUFBSSxFQUFFLENBQUE7Z0JBQ1YsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO1lBQ1osQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDLENBQUMsQ0FBQztJQUVQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9wbGF5bGlzdGZpbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBtb2NoYSBmcm9tIFwibW9jaGFcIjtcbmltcG9ydCAqIGFzIGNoYWkgZnJvbSBcImNoYWlcIjtcblxuLy8gaW1wb3J0IGNvdWNoYXV0aD0gcmVxdWlyZShcIi4uL2luZGV4XCIpO1xuXG5pbXBvcnQgeyBtcHZkYWVtb24gfSBmcm9tIFwiLi4vaW5kZXhcIjtcblxuXG5jb25zdCBQbGF5ZXIgPSBuZXcgbXB2ZGFlbW9uKClcblxuXG5cbmNvbnN0IGV4cGVjdCA9IGNoYWkuZXhwZWN0O1xuXG5kZXNjcmliZShcIm1wdiBjbGFzcyBwbGF5bGlzdCBmcm9tIGZpbGVcIiwgZnVuY3Rpb24gKCkge1xuICAgIGRlc2NyaWJlKFwiY29uZmlndXJhdGlvblwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgaXQoXCJleHBlY3QgcmV0dXJuIGFuIG9iamVjdFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBleHBlY3QoUGxheWVyKS50by5iZS5vaztcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiZXhwZWN0IHRvIGhhdmUgcHJvcGVydHkgcGxheWxpc3RcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZXhwZWN0KFBsYXllcikudG8uaGF2ZS5wcm9wZXJ0eSgncGxheWxpc3QnKS50aGF0LmlzLmFuKCdhcnJheScpO1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJleHBlY3QgdG8gaGF2ZSBwcm9wZXJ0eSBkYWVtb25pemVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIpLnRvLmhhdmUucHJvcGVydHkoJ2RhZW1vbml6ZWQnKS50aGF0LmlzLm5vdC5va1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInN0YXJ0XCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQoNTAwMDApO1xuXG4gICAgICAgICAgICBQbGF5ZXIuc3RhcnQoKS50aGVuKGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFBsYXllcikudG8uaGF2ZS5wcm9wZXJ0eSgnZGFlbW9uaXplZCcpLnRoYXQuaXMub2tcbiAgICAgICAgICAgICAgICBkb25lKClcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoZXJyKS50by5ub3QuZXhpc3RcbiAgICAgICAgICAgICAgICBkb25lKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICBpdChcInBsYXllciBpcyBub3cgZGFlbW9uaXplZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBleHBlY3QoUGxheWVyKS50by5oYXZlLnByb3BlcnR5KCdkYWVtb25pemVkJykudGhhdC5pcy5va1xuICAgICAgICB9KTtcbiAgICAgICAgaXQoXCJwbGF5ZXIgaXMgbm90IHBsYXlpbmcgbm93XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIpLnRvLmhhdmUucHJvcGVydHkoJ3BsYXlpbmcnKS50aGF0LmlzLm5vdC5va1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuXG4gICAgZGVzY3JpYmUoXCJwbGF5bGlzdFwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgaXQoXCJsb2FkIGEgcGxheWxpc3QgZnJvbSBmaWxlXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQoNTAwMDApO1xuXG4gICAgICAgICAgICBQbGF5ZXIubG9hZExpc3Rmcm9tRmlsZShfX2Rpcm5hbWUgKyBcIi9sb2NhbHBsYXlsaXN0LnBsc1wiLCB0cnVlKS50aGVuKChhKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFBsYXllci5wbGF5bGlzdC5sZW5ndGgpLnRvLmJlLmVxKDIpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIucGxheWxpc3RbMF0pLnRvLmhhdmUucHJvcGVydHkoJ3RpdGxlJyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFBsYXllci5wbGF5bGlzdFswXSkudG8uaGF2ZS5wcm9wZXJ0eSgndXJpJyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFBsYXllci5wbGF5bGlzdFswXSkudG8uaGF2ZS5wcm9wZXJ0eSgnbGFiZWwnKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIucGxheWluZykudG8uYmUub2s7XG5cblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBkb25lKClcbiAgICAgICAgICAgICAgICB9LCAzMDAwKVxuXG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgICAgIGV4cGVjdChlcnIpLnRvLm5vdC5leGlzdFxuICAgICAgICAgICAgICAgIGRvbmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJwbGF5ZXIgaXMgcnVubmluZyBub3dcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZXhwZWN0KFBsYXllcikudG8uaGF2ZS5wcm9wZXJ0eSgncGxheWluZycpLnRoYXQuaXMub2tcbiAgICAgICAgfSk7XG4gICAgICAgIGl0KFwiVGhlIHRyYWNrIGlzIHRoZSBudW1iZXIgMVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBleHBlY3QoUGxheWVyKS50by5oYXZlLnByb3BlcnR5KCd0cmFjaycpLnRoYXQuZXEoMSlcbiAgICAgICAgfSk7XG5cblxuXG4gICAgICAgIGl0KFwic3dpdGNoIHRvIG5leHQgdHJhY2sgd2hhdFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0KDUwMDAwKTtcblxuICAgICAgICAgICAgUGxheWVyLm5leHQoKS50aGVuKChhKSA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFBsYXllci5wbGF5bGlzdC5sZW5ndGgpLnRvLmJlLmVxKDIpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIpLnRvLmhhdmUucHJvcGVydHkoJ3RyYWNrJykudGhhdC5lcSgyKVxuXG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpXG4gICAgICAgICAgICAgICAgfSwgMzAwMClcblxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChlcnIpLnRvLm5vdC5leGlzdFxuICAgICAgICAgICAgICAgIGRvbmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG5cblxuICAgICAgICBpdChcInN3aXRjaCB0byBwcmV2IHRyYWNrIGJlc3RcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dCg1MDAwMCk7XG5cbiAgICAgICAgICAgIFBsYXllci5wcmV2KCkudGhlbigoYSkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIucGxheWxpc3QubGVuZ3RoKS50by5iZS5lcSgyKTtcbiAgICAgICAgICAgICAgICBleHBlY3QoUGxheWVyKS50by5oYXZlLnByb3BlcnR5KCd0cmFjaycpLnRoYXQuZXEoMSlcblxuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKVxuICAgICAgICAgICAgICAgIH0sIDMwMDApXG5cbiAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoZXJyKS50by5ub3QuZXhpc3RcbiAgICAgICAgICAgICAgICBkb25lKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG5cblxuICAgIH0pO1xuICAgIGRlc2NyaWJlKFwic3RhcnQgd2l0aCBhIHZpZGVvXCIsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBpdChcImV4cGVjdCBhIHZpZGVvXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQoNTAwMDApO1xuXG4gICAgICAgICAgICBQbGF5ZXIucGxheShfX2Rpcm5hbWUgKyBcIi8uLi92aWRlb3MvaG9lZG93bi5tcDRcIikudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFBsYXllcikudG8uYmUub2s7XG4gICAgICAgICAgICAgICAgZXhwZWN0KFBsYXllci5wbGF5bGlzdC5sZW5ndGgpLnRvLmJlLmVxKDEpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIpLnRvLmhhdmUucHJvcGVydHkoJ3RyYWNrJykudGhhdC5lcSgxKVxuXG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpXG4gICAgICAgICAgICAgICAgfSwgMzAwMClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic3dpdGNoIHRvIGFub3RoZXIgdmlkZW9cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dCg1MDAwMCk7XG4gICAgICAgICAgICBQbGF5ZXIuc3RhcnQoX19kaXJuYW1lICsgXCIvLi4vdmlkZW9zL3RvY2NhdGEubXA0XCIpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIpLnRvLmJlLm9rO1xuICAgICAgICAgICAgICAgIGV4cGVjdChQbGF5ZXIucGxheWxpc3QubGVuZ3RoKS50by5iZS5lcSgxKTtcbiAgICAgICAgICAgICAgICBleHBlY3QoUGxheWVyKS50by5oYXZlLnByb3BlcnR5KCd0cmFjaycpLnRoYXQuZXEoMSlcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpXG4gICAgICAgICAgICAgICAgfSwgMzAwMClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG59KTsiXX0=
